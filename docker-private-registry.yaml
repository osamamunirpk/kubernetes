---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env:
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTANT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVERENDQXZTZ0F3SUJBZ0lVVFErZ0RrY3Z5bC9ieVNVTUVFNmJucTBodUFvd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTVRreE1ESTRNVGswTURBd1doY05NakF4TURJM01UazAKTURBd1dqQnhNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ0JNTVVHVnVibk41YkhaaGJtbGhNUk13RVFZRApWUVFIRXdwSVlYSnlhWE5pZFhKbk1STXdFUVlEVlFRS0V3cExkV0psY201bGRHVnpNU0V3SHdZRFZRUUxFeGhMCmRXSmxjbTVsZEdWeklGUm9aU0JCYkhSaE15QlhZWGt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUUMzUVEyLzRFV091K2xRMTEyT2NuMEtkOCtkZWozRTZMQzlaY3FEVzN5d05KRXR6MlVvOHpldQovd1BhUVRJWG5uTnpVSzQzQnZDRDRLQmJPVnY2U1ByNzJpWUp6eDlMNWovUitGTXR6QnhCTmxWY2d3ZEZCNFVnCld4TzNDYml2MDUydzdwZWpYSldYWlBWWVlmUE12cVNtb2dqVHg3UjNCamtXbUlNVkVqQ3BBbTJYVHhodlN3VHkKNitGWFI4TnVJUXo2YjBhc0taL2NCaGtvZTlObGJxdVZuQ081dG1OMDN2TzBFelN2M1lwaGtUTk1EL2REeTBNQwpmZm8wWnlBWGRUT1R5ZmFJUytIOXM5WHpKeXNJT1FJZXprbHppQTJyblZwUlI4KzFLTDFrMVBQcTh5ZXlBTStRCnNjdlJsVWlRQjg0Y3FtTzVnTHFYaHpCTDlENTBsc1IzQWdNQkFBR2pnWnd3Z1prd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQQpNQjBHQTFVZERnUVdCQlMydHFFVURCQU5FbUlNZVhoTjRISHIvRUlXU0RBZkJnTlZIU01FR0RBV2dCU1ROd0tTClFPV2ZjL1M4ZW16R2tUQVBEd3JxYVRBYUJnTlZIUkVFRXpBUmdnbHNiMk5oYkdodmMzU0hCSDhBQUFFd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBRmJBdjQ2OWJNM25oM1VRaFFNN21oRndwazRMdVNEZU9RYnE2c3VKSnNjUAo1V3VyUm42VGd3N3FNVU5YUVo5Q3AzYjlMT2lhQXhucVEzeFZNaTFLWUpkNnEyOGpXUFVRd1lka0VxMUhReURICmpDa2VKK1BKVHN4Wk5MMlFMV21idmVyRWxJaWRGZGpxbDNoaE9CcXJ1S281V0ZoaUJHbU1aTU1rR2lOZnkrLzMKRS9SbUpPbWZ6RmY2eXlNak5nQmNJL1I4bkdtZTNWeS9mS3lTN2g3QkVjZlhSMTBYQkxwUmxaZmEvYTFsQzdmdQpUdmFTejl2M3Y4YXRPbHJ4b3k2dmczNTVVV21ORVhRSWFjT1B4Q3JUUkd0RDlqLzFJVXlrMnhSVDJSbEZrYWUzCjArZ0RWZDJWU1ZBSXhCS3pNTEZrOWhnK3NHMHdGRzRXci9pYkRPVkxpa0E9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBdDBFTnYrQkZqcnZwVU5kZGpuSjlDbmZQblhvOXhPaXd2V1hLZzF0OHNEU1JMYzlsCktQTTNydjhEMmtFeUY1NXpjMUN1Tndid2crQ2dXemxiK2tqNis5b21DYzhmUytZLzBmaFRMY3djUVRaVlhJTUgKUlFlRklGc1R0d200cjlPZHNPNlhvMXlWbDJUMVdHSHp6TDZrcHFJSTA4ZTBkd1k1RnBpREZSSXdxUUp0bDA4WQpiMHNFOHV2aFYwZkRiaUVNK205R3JDbWYzQVlaS0h2VFpXNnJsWndqdWJaamRON3p0Qk0wcjkyS1laRXpUQS8zClE4dERBbjM2TkdjZ0YzVXprOG4yaUV2aC9iUFY4eWNyQ0RrQ0hzNUpjNGdOcTUxYVVVZlB0U2k5Wk5UejZ2TW4Kc2dEUGtMSEwwWlZJa0FmT0hLcGp1WUM2bDRjd1MvUStkSmJFZHdJREFRQUJBb0lCQUVvV2d2aVFNNDhCYWRMRgpQNDNYdTdYL3VuQndlNGlnaXRRSDAxaElKS0VZbjVsbHdBQk9WTFRyWlNOWU9HaFVKMWozeFhkNTFzTjZqVnBVClZsdGFKaDZzazdSamlNT20weWFRdnhCRTlTZG9VQnFXM3RtSnNNamtDWlIyMmJROFdnU3VjYUFhVG1CbThNcEsKejhaM1RSb1JhSUEydlQ5aHhMTGQ5aUVPdVoyYUxwRTJ4MjFQWTlEZC9qZmp5ajZQSU1uMDZXckFrS0ZLZytpRApsWFA4R3JRYk1BOXNSKytvb2lsNWgvS2JLdDBWMm1DQkxnMElieEwwU3o0R1F3YTBqejFocC8vOWJ2Q0pWdlY2ClArVFE3R3YrVkRya2d2ODFvT2cyN1crOUlqemlEQ2FtNncrN0xONlNzZEo5UmhlUDlkK3NMV25QZHVVOGhPTFoKcExYaG9BRUNnWUVBMlZyVllyZnZleVQ0V0tlQkszeGNtMThjZ2JkbUhuZEpuci9XaVhZVzNneUVPcFB4MGlQcApBUi93Z1Blc3dWK1doNTVNYXZUUzRZQWlweDNnT0gyLzA0enAvT0hDOWtOb3JBblI0Y1owOGxyblBEaTBvUTltCjZNN3FwMGVxSk5xY1J3Ym5hYlptNHNTVlQ0ekMraS96QSswaWN5aDBXR2w2dGZrMGZ1azRwNWNDZ1lFQTE5WVYKNm92YUl0aHlKc1pUanZTZEx6TTZ4b0ZYOUxNQlgvSFpRQjludlA0UGhjeHpWazFtVVFNc0hrVFdPR01ON0JURAphRTV4bmRmM2VpMDhzUTlIR0c3bnB4VjZQc01HZENBellSS2JzNmptYm1DZHBjVzJ3RjdqSWQ3Y2FacEIzUW5qCi93QXR2c3BDcWtsUU5xMHByeUxWdWZCT08xVWdlZ1VveThMMVppRUNnWUE1cWhLUXBUSGczdGNRVmlnN3pEdVoKY090VU1yN2grRTNNMHlKc3g2cWJjSUNvTmRYakpXbk14WmQ5NzdlaWVlU3F5RUdINHJvTDMzM1NEbWdOTkxkdQp2YVRhVlY3dkRNVTVWMFdhZTVkTk1QYkdFRmxEbloxMHlHaVN4cjJLRjRGOGlvVmNrMnJLWU5Nb0RyVXZ3UWJkCkZNMmQ5YTZnUWlPdklaVmUwaXNZc3dLQmdCVzAyeWxtZlQ2cDQva1FVeEQ2ZXVCblY0N2xMVEpYMmxpSzJ4MSsKeXhFUHdBSGx5T2V5Q3dzMHRYZ3AxaDEvb01QUVpzS1R1UXQxejliQ3UrcldyWURBanAyWUpGNHhnUEdtMTJQNAoyaDNjYTZoSUlUS3R5cTVZSEtHb1p5UmJ0aW9EdDZGS3BFOGV5a3VUNmZSRnYvNTBFMmlLeVdOZ01VNzBPK0VhCkwxSGhBb0dBTjZTMEdoYWs4MHNlNlNjR1BkbFpmbHJ5UU5oSHczRzY5REM4UTk2RmhMRDlYazBlUWVINXF6STUKVFUxdkVNWlM0b3ZSN2lMT0lwY0NTaHY1amZZZDg5em1lVWgzL0xQZnFqRjh3RGZzbVhRM2NnMmlEQkgveHIvcwpoajhISzZQRG1zdjcxdW1lSGg0VlB5N2lJSWI2b3FYNTl3dndubjNQTTNmaDdPeUhxdDA9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
metadata:
  name: registry-tls
  namespace: default
type: Opaque
